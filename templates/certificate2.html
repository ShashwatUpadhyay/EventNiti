{% extends "index.html" %}
{% load static %}

{% block title %}
ðŸŽ‰ Achievement Unlocked: {{ certi_obj.event.title }} Certificate! ðŸŽ‰
{% endblock title %}

{% block head_extra %}
{# Font Awesome (kept from previous) #}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
{# Canvas Confetti Library #}
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<style>
    /* Base Animation Keyframes */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    @keyframes scaleIn {
        from { opacity: 0; transform: scale(0.8); }
        to { opacity: 1; transform: scale(1); }
    }
    @keyframes pulseGlow {
        0%, 100% { box-shadow: 0 0 15px 5px rgba(251, 191, 36, 0.3); transform: scale(1); } /* Amber glow */
        50% { box-shadow: 0 0 25px 10px rgba(251, 191, 36, 0.5); transform: scale(1.05); }
    }

    /* Animation Utility Classes */
    .animate-on-load {
        opacity: 0; /* Start hidden */
        animation-fill-mode: forwards; /* Stay visible after animation */
        animation-duration: 0.8s; /* Default duration */
        animation-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1); /* Smooth easing */
    }
    .fade-in-up { animation-name: fadeInUp; }
    .scale-in { animation-name: scaleIn; }
    .pulse-glow { animation-name: pulseGlow; animation-duration: 2.5s; animation-iteration-count: infinite; animation-timing-function: ease-in-out;}

    /* Staggered Delays */
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }
    .delay-400 { animation-delay: 0.4s; }
    .delay-500 { animation-delay: 0.5s; }
    .delay-600 { animation-delay: 0.6s; }
    .delay-700 { animation-delay: 0.7s; }
    .delay-900 { animation-delay: 0.9s; }
    .delay-1100 { animation-delay: 1.1s; }
    .delay-1300 { animation-delay: 1.3s; }


    /* 5. Vibrant Page Background */
    @keyframes vibrantGradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    .vibrant-animated-background {
        /* Brighter, more saturated gradient */
        background: linear-gradient(135deg, #667eea, #764ba2, #fde68a, #764ba2, #667eea); /* Indigo -> Purple -> Light Gold -> Purple -> Indigo */
        background-size: 400% 400%;
        animation: vibrantGradient 20s ease infinite;
    }

    /* Certificate Pattern (kept) */
    .certificate-pattern { /* ... (same as before) ... */ }

    /* Decorative Corners (kept) */
    .certificate-corners::before, .certificate-corners::after, #certificate::before, #certificate::after { /* ... (same as before) ... */ }

    /* Shimmer Effect (kept) */
    .shimmer-overlay::before { /* ... (same as before) ... */ }

    /* Styling for Print & Reduced Motion */
    @media print {
        /* ... (previous print styles remain, ensuring no animations/fancy backgrounds print) ... */
        .animate-on-load { opacity: 1 !important; animation: none !important; } /* Ensure visible */
    }

    @media (prefers-reduced-motion: reduce) {
      .animate-on-load, .pulse-glow, .vibrant-animated-background, .shimmer-overlay::before, #certificate-wrapper:hover #certificate {
        animation: none !important;
        transition: none !important;
      }
      .animate-on-load { opacity: 1 !important; } /* Make elements visible immediately */
      #certificate-wrapper:hover #certificate {
          transform: none !important; /* Disable hover transform */
      }
    }

    /* Minor hover adjustment */
    @media screen and (prefers-reduced-motion: no-preference) {
       #certificate-wrapper:hover #certificate {
           box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.35);
           transform: translateY(-8px) scale(1.02); /* Slightly increased scale on hover */
       }
    }

</style>
{% endblock head_extra %}

{% block content %}
{# 5. Applied Vibrant Animated Background #}
<div class="min-h-screen vibrant-animated-background flex flex-col items-center justify-center py-16 px-4 overflow-x-hidden">

    {# Top intro text with animation #}
    <div id="certificate-wrapper" class="w-full max-w-4xl lg:max-w-5xl mb-6 no-print">
         <p class="text-center text-white mb-4 text-base sm:text-lg font-medium animate-on-load fade-in-up delay-1300" style="text-shadow: 0 1px 3px rgba(0,0,0,0.3);">
             <i class="fas fa-star text-yellow-300"></i> This is Your Moment! Celebrate Your Achievement! <i class="fas fa-star text-yellow-300"></i>
         </p>
    </div>

    <div id="certificate-container" class="w-full max-w-4xl lg:max-w-5xl mb-10">
        {# THE CERTIFICATE :: Added entry animation class #}
        <div id="certificate"
             class="relative bg-white certificate-pattern rounded-lg shadow-2xl overflow-hidden border-t-8 border-indigo-700 transition-all duration-500 ease-in-out mx-auto certificate-corners shimmer-overlay animate-on-load scale-in delay-100">
             {# Shimmer & Corners applied via CSS #}

            <div class="relative z-10">
                {# Certificate Header :: Added animation classes #}
                <div class="px-8 py-6 md:px-12 md:py-8 bg-gradient-to-r from-indigo-50 via-white to-purple-50 border-b border-gray-200 animate-on-load fade-in-up delay-300">
                    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                        <div>
                            <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-indigo-800 tracking-tight">
                                Certificate of Achievement
                            </h1>
                            <p class="text-sm sm:text-base text-gray-600 mt-1 italic">
                                Awarded for participation in: <span class="font-semibold">{{ certi_obj.event.title }}</span>
                            </p>
                        </div>
                        {# Enhanced Seal :: Added pulse animation class #}
                        <div class="seal-container mt-4 sm:mt-0 w-20 h-20 bg-gradient-to-br from-yellow-300 via-amber-500 to-yellow-400 rounded-full flex items-center justify-center border-2 border-amber-600 shadow-lg p-1 shrink-0 animate-on-load scale-in delay-700">
                             <div class="pulse-glow"> {# Apply pulse to inner div if needed, or directly to seal-container #}
                                 <i class="fas fa-medal text-4xl text-white" style="filter: drop-shadow(0 1px 1px rgba(0,0,0,0.5));"></i>
                             </div>
                        </div>
                    </div>
                </div>

                {# Certificate Main Content :: Added animation classes #}
                <div class="px-8 py-8 md:px-12 md:py-10 text-center animate-on-load fade-in-up delay-500">
                    <p class="text-lg text-gray-500 mb-2">Proudly Presented To</p>
                    <h2 class="text-3xl md:text-4xl lg:text-5xl font-semibold text-gray-900 break-words animate-on-load fade-in-up delay-600" style="font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, serif;">
                        {{ certi_obj.user.first_name }} {{ certi_obj.user.last_name }}
                    </h2>

                    {# Stylized Divider (kept) :: Added animation #}
                    <div class="my-6 text-center animate-on-load scale-in delay-700">
                        <svg class="inline-block h-4 sm:h-5 text-amber-500" viewBox="0 0 100 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0 7.5 C 10 0, 20 0, 30 7.5 S 40 15, 50 7.5 S 60 0, 70 7.5 S 80 15, 90 7.5 S 100 0, 100 7.5" stroke="currentColor" stroke-width="2"/>
                            <circle cx="50" cy="7.5" r="3" fill="currentColor"/>
                        </svg>
                    </div>

                    <p class="text-base sm:text-lg text-gray-700 max-w-2xl mx-auto leading-relaxed">
                        For successfully completing and demonstrating commendable engagement during the
                        <span class="font-semibold text-indigo-700">{{ certi_obj.event.title }}</span> event,
                        hosted with distinction by <span class="font-semibold">{{ certi_obj.event.organiser.name | default:'Our Platform' }}</span>.
                    </p>
                </div>

                {# Certificate Footer :: Added animation classes #}
                <div class="px-8 py-6 md:px-12 md:py-8 bg-gray-50 border-t border-gray-200 animate-on-load fade-in-up delay-900">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                        {# Left Side: Date & QR (kept) #}
                        <div class="flex items-center gap-4 text-center md:text-left">
                            <img src="data:image/png;base64,{{qr_code_base64}}" alt="Verification QR Code" class="w-20 h-20 md:w-24 md:h-24 rounded-md shadow-md border-2 border-gray-300 p-1 bg-white transition-transform duration-200 hover:scale-105">
                            <div>
                                <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider">Issued On</p>
                                <p class="text-base md:text-lg font-medium text-gray-800">{{ certi_obj.issue_date|date:"F j, Y" }}</p>
                                <p class="text-xs text-gray-500 mt-2">Scan QR to Verify Authenticity</p>
                            </div>
                        </div>
                        {# Right Side: Signature & Verification (kept) #}
                        <div class="text-center md:text-right w-full md:w-auto">
                             <p class="text-xs text-gray-500 font-semibold uppercase tracking-wider">Authorized By</p>
                             <p class="font-cursive text-xl text-indigo-700 my-1">[Digital Signature Placeholder]</p>
                             <p class="text-sm font-medium text-gray-800">Event Coordinator</p>
                             <p class="mt-3 text-xs text-gray-500 break-all">
                                 <span class="font-semibold">ID:</span>
                                 <a href="{% url 'certificate' certi_obj.hash %}" class="text-indigo-600 hover:underline hover:text-amber-600" title="Verify Online">
                                     {{ certi_obj.hash }}
                                 </a>
                             </p>
                        </div>
                    </div>
                </div>
            </div> {# End z-10 wrapper #}
        </div>
    </div>

    {# ACTION BUTTONS :: Added animation classes & active state styling #}
    <div class="text-center no-print mt-6 sm:mt-0 animate-on-load fade-in-up delay-1100">
        <p class="text-lg text-white mb-6 font-medium" style="text-shadow: 0 1px 3px rgba(0,0,0,0.3);">Ready to Share Your Success?</p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
            <button id="download-btn"
                    class="inline-flex items-center justify-center gap-2 w-full sm:w-auto px-8 py-3 border border-transparent text-base font-medium rounded-md shadow-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 focus:ring-offset-gray-800 transition-all duration-200 transform hover:scale-105 hover:shadow-xl active:scale-95 active:brightness-90">
                <i class="fas fa-download"></i>
                Download PDF
            </button>

            {% if linkedin_url %}
            <a href='{{ linkedin_url }}' target='_blank' rel="noopener noreferrer"
               class="inline-flex items-center justify-center gap-2 w-full sm:w-auto px-8 py-3 border border-indigo-600 text-base font-medium rounded-md shadow-lg text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 focus:ring-offset-gray-800 transition-all duration-200 transform hover:scale-105 hover:shadow-xl active:scale-95 active:brightness-95">
                <i class="fab fa-linkedin"></i>
                Add to LinkedIn
            </a>
            {% endif %}
        </div>
         <p class="text-xs text-indigo-100 opacity-80 mt-4">Downloaded certificate is a high-resolution static PDF.</p>
    </div>

</div>

{# Confetti Trigger & html2pdf script #}
<script>
    // 1. Trigger Confetti!
    document.addEventListener('DOMContentLoaded', () => {
        // Check if user prefers reduced motion
        const motionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
        if (!motionQuery || !motionQuery.matches) {
            // Fun confetti settings
            const duration = 3 * 1000; // 3 seconds
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                const particleCount = 50 * (timeLeft / duration);
                // Launch confetti from both sides
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }
    });

    // html2pdf (kept from previous)
    document.getElementById("download-btn").addEventListener("click", () => {
        const element = document.getElementById("certificate");
         // Temporarily remove animations that might interfere JUST before screenshot
         element.style.animation = 'none';
         element.querySelectorAll('.animate-on-load, .pulse-glow').forEach(el => el.style.animation = 'none');

        const opt = { /* ... pdf options same as before ... */ };
        html2pdf().set(opt).from(element).save().then(() => {
            // Optional: Re-enable animations if needed, though usually fine after page reload
            // element.style.animation = '';
            // element.querySelectorAll('.animate-on-load, .pulse-glow').forEach(el => el.style.animation = '');
        });
    });
</script>

{% endblock content %}