{% extends 'dashboard/base.html' %}

{% block page_title %}Event Approvals{% endblock %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
/* Dropdown and Animation Styles */
.dropdown-row {
    transition: all 0.3s ease;
    position: relative;
    cursor: pointer;
}
.dropdown-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s cubic-bezier(0, 1, 0, 1);
    background-color: #f9fafb;
    border-radius: 0 0 0.5rem 0.5rem;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
}
.dropdown-content.expanded {
    max-height: 800px;
    transition: max-height 0.5s cubic-bezier(0.9, 0, 0.3, 0.9);
}
.rotate-180 {
    transform: rotate(180deg);
}

/* Button Styles */
.btn-approve {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    transform: translateY(0);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}
.btn-approve:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
}
.btn-approve:active {
    transform: translateY(0);
    box-shadow: 0 2px 10px rgba(16, 185, 129, 0.3);
}
.btn-approve::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 5px;
    height: 5px;
    background: rgba(255, 255, 255, 0.4);
    opacity: 0;
    border-radius: 100%;
    transform: scale(1, 1) translate(-50%, -50%);
    transform-origin: 50% 50%;
}
.btn-approve:focus:not(:active)::after {
    animation: ripple 1s ease-out;
}

.btn-reject {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
    transform: translateY(0);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}
.btn-reject:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
}
.btn-reject:active {
    transform: translateY(0);
    box-shadow: 0 2px 10px rgba(239, 68, 68, 0.3);
}
.btn-reject::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 5px;
    height: 5px;
    background: rgba(255, 255, 255, 0.4);
    opacity: 0;
    border-radius: 100%;
    transform: scale(1, 1) translate(-50%, -50%);
    transform-origin: 50% 50%;
}
.btn-reject:focus:not(:active)::after {
    animation: ripple 1s ease-out;
}

/* Card and Table Styles */
.event-card {
    transition: all 0.2s ease;
    border-left: 4px solid transparent;
}
.event-card:hover {
    background-color: #f8fafc;
    transform: translateY(-1px);
    border-left-color: #6366f1;
}
.event-card.pending:hover {
    border-left-color: #eab308;
}
.event-card.approved:hover {
    border-left-color: #10b981;
}
.event-card.rejected:hover {
    border-left-color: #ef4444;
}

/* Accessibility and Focus Styles */
.btn:focus, button:focus {
    outline: 2px solid #6366f1;
    outline-offset: 2px;
}

/* Animation Keyframes */
@keyframes ripple {
    0% {
        transform: scale(0, 0);
        opacity: 1;
    }
    20% {
        transform: scale(25, 25);
        opacity: 1;
    }
    100% {
        opacity: 0;
        transform: scale(40, 40);
    }
}

/* Responsive Design Improvements */
@media (max-width: 768px) {
    .event-details-grid {
        grid-template-columns: 1fr;
    }
    .action-buttons {
        flex-direction: column;
        align-items: stretch;
        gap: 0.5rem;
    }
}

/* Accessibility Improvements */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* Loading State */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(255, 255, 255, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 50;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
}
.loading-overlay.active {
    opacity: 1;
    visibility: visible;
}
.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #6366f1;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="flex items-center justify-between mb-6">
    <div>
        <h1 class="text-2xl font-bold text-gray-900">Event Approvals</h1>
        <p class="text-gray-600">Review and manage event approval requests</p>
    </div>
    <div class="flex items-center space-x-3">
        <div class="bg-white rounded-lg px-4 py-2 border border-gray-200">
            <span class="text-sm text-gray-600">Total: {{ total_events }}</span>
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl p-6 text-white">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-yellow-100 text-sm">Pending Approval</p>
                <p class="text-3xl font-bold">{{ pending_count }}</p>
            </div>
            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                </svg>
            </div>
        </div>
    </div>

    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-green-100 text-sm">Approved</p>
                <p class="text-3xl font-bold">{{ approved_count }}</p>
            </div>
            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
            </div>
        </div>
    </div>

    <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl p-6 text-white">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-red-100 text-sm">Rejected</p>
                <p class="text-3xl font-bold">{{ rejected_count }}</p>
            </div>
            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                </svg>
            </div>
        </div>
    </div>
</div>

<!-- Pending Approvals Section -->
<div class="bg-white rounded-xl shadow-sm mb-8">
    <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
            <div class="w-2 h-2 bg-yellow-500 rounded-full mr-3"></div>
            Pending Approvals ({{ pending_count }})
        </h3>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Event</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Organizer</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Submitted</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for event in pending_events %}
                <tr class="dropdown-row event-card pending" data-event-id="{{ event.id }}">
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center mr-3">
                                 <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div>
                                <p class="font-medium text-gray-900 event-title">{{ event.title }}</p>
                                <p class="text-sm text-gray-500">{{ event.location|default:"Online" }}</p>
                            </div>
                            <button type="button" class="ml-2 focus:outline-none" aria-label="Toggle event details" onclick="toggleEventDetails('{{ event.id }}')">
                                <svg class="w-5 h-5 transform transition-transform duration-200 chevron-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                                <span class="sr-only">Toggle details for {{ event.title }}</span>
                            </button>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ event.organized_by.get_full_name|default:event.organized_by.username }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ event.start_date|date:"M d, Y" }}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">{{ event.upload_time|timesince }} ago</td>
                    <td class="px-6 py-4">
                        <div class="flex space-x-3 action-buttons">
                            <button 
                                onclick="event.stopPropagation(); confirmApprove('{{ event.uid }}', '{{ event.title }}')" 
                                class="btn-approve text-gray-700 bg-green-500 px-4 py-2 rounded-lg text-sm flex items-center justify-center transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 w-28"
                                aria-label="Approve event: {{ event.title }}"
                            >
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                Approve
                            </button>
                            <button 
                                onclick="event.stopPropagation(); confirmReject('{{ event.uid }}', '{{ event.title }}')" 
                                class="btn-reject text-gray-700 bg-red-500 px-4 py-2 rounded-lg text-sm flex items-center justify-center transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 w-28"
                                aria-label="Reject event: {{ event.title }}"
                            >
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                                Reject
                            </button>
                        </div>
                    </td>
                </tr>
                <tr class="dropdown-content" id="details-{{ event.id }}">
                    <td colspan="5" class="px-6 py-4 bg-gray-50">
                        <div class="grid grid-cols-2 gap-6 event-details-grid">
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    Event Details
                                </h4>

                                <div class="space-y-3 text-sm">
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-700">Description:</span>
                                        {% include "dashboard/view_description_modal.html" with event=event %}
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-700">Location:</span>
                                        <p class="text-gray-600">{{ event.location|default:"Online" }}</p>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-700">Start Date & Time:</span>
                                        <p class="text-gray-600">{{ event.start_date|date:"M d, Y h:i A" }}</p>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-700">End Date & Time:</span>
                                        <p class="text-gray-600">{{ event.end_date|date:"M d, Y h:i A" }}</p>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-700">Registration Deadline:</span>
                                        <p class="text-gray-600">{{ event.last_date_of_registration|date:"M d, Y h:i A" }}</p>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-700">Total Seats:</span>
                                        {% if event.limit > 0 %}
                                        <p class="text-gray-600">{{ event.limit }}</p>
                                        {% else %}
                                        <p class="text-gray-600">Unlimited</p>
                                        {% endif %}
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-700">Price:</span>
                                        <p class="text-gray-600">{{ event.price }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    Organizer Details
                                </h4>
                                <div class="space-y-3 text-sm">
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-700">Organizer:</span>
                                        <p class="text-gray-600">{{ event.organized_by.get_full_name|default:event.organized_by.username }}</p>
                                    </div>
                                </div>
                                <div class="flex flex-col">
                                    <span class="font-medium text-gray-700">Email:</span>
                                    <p class="text-gray-600">{{ event.organized_by.email }}</p>
                                </div>
                                <div class="flex flex-col">
                                    <span class="font-medium text-gray-700">Phone:</span>
                                    <p class="text-gray-600">{{ event.organized_by.user_extra.phone }}</p>
                                </div>
                                
                            </div>

                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                        <div class="flex flex-col items-center justify-center">
                            <svg class="w-12 h-12 text-gray-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <p>No pending approvals</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Approved Events Section -->
<div class="bg-white rounded-xl shadow-sm mb-8">
    <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
            <div class="w-2 h-2 bg-green-500 rounded-full mr-3"></div>
            Approved Events ({{ approved_count }})
        </h3>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Event</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Organizer</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Approved</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for event in approved_events %}
                <tr class="dropdown-row event-card approved" data-event-id="{{ event.id }}-approved">
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div>
                                <p class="font-medium text-gray-900 event-title">{{ event.title }}</p>
                                <p class="text-sm text-gray-500">{{ event.location|default:"Online" }}</p>
                            </div>
                            <button type="button" class="ml-2 focus:outline-none" aria-label="Toggle event details" onclick="toggleEventDetails('{{ event.id }}-approved')">
                                <svg class="w-5 h-5 transform transition-transform duration-200 chevron-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                                <span class="sr-only">Toggle details for {{ event.title }}</span>
                            </button>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ event.organized_by.get_full_name|default:event.organized_by.username }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ event.start_date|date:"M d, Y" }}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">{{ event.approved_at|timesince }} ago</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium inline-flex items-center">
                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            Approved
                        </span>
                    </td>
                </tr>
                <tr class="dropdown-content" id="details-{{ event.id }}-approved">
                    <td colspan="5" class="px-6 py-4 bg-gray-50">
                        <div class="grid grid-cols-2 gap-6 event-details-grid">
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    Event Details
                                </h4>
                                <div class="space-y-3 text-sm">
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-700">Description:</span>
                                        <p class="text-gray-600 mt-1">{{ event.description }}</p>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <div>
                                            <span class="font-medium text-gray-700">Category:</span>
                                            <p class="text-gray-600">{{ event.category }}</p>
                                        </div>
                                        <div>
                                            <span class="font-medium text-gray-700">Capacity:</span>
                                            <p class="text-gray-600">{{ event.capacity }} attendees</p>
                                        </div>
                                        <div>
                                            <span class="font-medium text-gray-700">Duration:</span>
                                            <p class="text-gray-600">{{ event.duration }} hours</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
                                    </svg>
                                    Organizer Details
                                </h4>
                                <div class="space-y-3 text-sm">
                                    <div>
                                        <span class="font-medium text-gray-700">Name:</span>
                                        <p class="text-gray-600">{{ event.organized_by.get_full_name|default:event.organized_by.username }}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-gray-700">Email:</span>
                                        <p class="text-gray-600">{{ event.organized_by.email }}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-gray-700">Phone:</span>
                                        <p class="text-gray-600">{{ event.organized_by.phone|default:"Not provided" }}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-gray-700">Organization:</span>
                                        <p class="text-gray-600">{{ event.organization|default:"Not specified" }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                        <div class="flex flex-col items-center justify-center">
                            <svg class="w-12 h-12 text-gray-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <p>No approved events</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Rejected Events Section -->
<div class="bg-white rounded-xl shadow-sm">
    <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
            <div class="w-2 h-2 bg-red-500 rounded-full mr-3"></div>
            Rejected Events ({{ rejected_count }})
        </h3>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Event</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Organizer</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rejected</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for event in rejected_events %}
                <tr class="dropdown-row event-card rejected" data-event-id="{{ event.id }}-rejected">
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                                <svg class="w-5 h-5 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div>
                                <p class="font-medium text-gray-900 event-title">{{ event.title }}</p>
                                <p class="text-sm text-gray-500">{{ event.location|default:"Online" }}</p>
                            </div>
                            <button type="button" class="ml-2 focus:outline-none" aria-label="Toggle event details" onclick="toggleEventDetails('{{ event.id }}-rejected')">
                                <svg class="w-5 h-5 transform transition-transform duration-200 chevron-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                                <span class="sr-only">Toggle details for {{ event.title }}</span>
                            </button>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ event.organized_by.get_full_name|default:event.organized_by.username }}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">{{ event.start_date|date:"M d, Y" }}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">{{ event.rejected_at|timesince }} ago</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium inline-flex items-center">
                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                            </svg>
                            Rejected
                        </span>
                    </td>
                </tr>
                <tr class="dropdown-content" id="details-{{ event.id }}-rejected">
                    <td colspan="5" class="px-6 py-4 bg-gray-50">
                        <div class="grid grid-cols-2 gap-6 event-details-grid">
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    Event Details
                                </h4>
                                <div class="space-y-3 text-sm">
                                    <div class="flex flex-col">
                                        <span class="font-medium text-gray-700">Description:</span>
                                        <p class="text-gray-600 mt-1">{{ event.description }}</p>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <div>
                                            <span class="font-medium text-gray-700">Category:</span>
                                            <p class="text-gray-600">{{ event.category }}</p>
                                        </div>
                                        <div>
                                            <span class="font-medium text-gray-700">Capacity:</span>
                                            <p class="text-gray-600">{{ event.capacity }} attendees</p>
                                        </div>
                                        <div>
                                            <span class="font-medium text-gray-700">Duration:</span>
                                            <p class="text-gray-600">{{ event.duration }} hours</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    Rejection Details
                                </h4>
                                <div class="space-y-3 text-sm">
                                    <div>
                                        <span class="font-medium text-gray-700">Rejected At:</span>
                                        <p class="text-gray-600">{{ event.rejected_at|date:"F j, Y, g:i a" }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                        <div class="flex flex-col items-center justify-center">
                            <svg class="w-12 h-12 text-gray-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <p>No rejected events</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    // Toggle event details dropdown
    function toggleEventDetails(eventId) {
        const detailsRow = document.getElementById(`details-${eventId}`);
        const eventRow = document.querySelector(`[data-event-id="${eventId}"]`);
        const chevronIcon = eventRow.querySelector('.chevron-icon');
        
        if (detailsRow.classList.contains('expanded')) {
            // Hide details
            detailsRow.classList.remove('expanded');
            chevronIcon.classList.remove('rotate-180');
            // Add animation class for smooth transition
            detailsRow.classList.add('hiding');
            setTimeout(() => {
                detailsRow.classList.remove('hiding');
                detailsRow.style.display = 'none';
            }, 300); // Match this with CSS transition duration
        } else {
            // Show details
            detailsRow.style.display = 'table-row';
            // Trigger reflow to enable transition
            detailsRow.offsetHeight;
            detailsRow.classList.add('expanded');
            chevronIcon.classList.add('rotate-180');
        }
    }
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    cookie = cookie.trim();
                    if (cookie.startsWith(name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    // Confirm approve event with SweetAlert
    function confirmApprove(eventId, eventTitle) {
        console.log(eventId, eventTitle);
        Swal.fire({
            title: 'Approve Event?',
            text: `Are you sure you want to approve "${eventTitle}"?`,
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#10B981',
            cancelButtonColor: '#6B7280',
            confirmButtonText: 'Yes, approve it!',
            cancelButtonText: 'Cancel',
            customClass: {
                confirmButton: 'swal-confirm-button',
                cancelButton: 'swal-cancel-button'
            },
            showClass: {
                popup: 'animate__animated animate__fadeInDown'
            },
            hideClass: {
                popup: 'animate__animated animate__fadeOutUp'
            }
        }).then((result) => {
            if (result.isConfirmed) {
                // Show loading state
                const approveBtn = document.querySelector(`button[onclick="event.stopPropagation(); confirmApprove('${eventId}', '${eventTitle}')"]`);
                if (approveBtn) {
                    approveBtn.disabled = true;
                    approveBtn.innerHTML = '<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Processing...';
                }
                console.log(eventId);
                // Make API call to approve the event
                const csrftoken = getCookie('csrftoken');
                const formData = new FormData();
                formData.append("uid", eventId);
                formData.append("action", "approve");
                fetch(`{% url "dashboard:approve_event" %}`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                        //'Content-Type': 'application/json',
                    },
                    body: formData
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status === 'success') {
                        Swal.fire({
                            title: 'Approved!',
                            text: 'The event has been approved successfully.',
                            icon: 'success',
                            confirmButtonColor: '#10B981',
                            timer: 2000,
                            timerProgressBar: true
                        }).then(() => {
                            location.reload();
                        });
                    } else {
                        // Reset button state
                        if (approveBtn) {
                            approveBtn.disabled = false;
                            approveBtn.innerHTML = '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>Approve';
                        }
                        
                        Swal.fire({
                            title: 'Error!',
                            text: data.message || 'Something went wrong',
                            icon: 'error',
                            confirmButtonColor: '#EF4444'
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    
                    // Reset button state
                    if (approveBtn) {
                        approveBtn.disabled = false;
                        approveBtn.innerHTML = '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>Approve';
                    }
                    
                    Swal.fire({
                        title: 'Error!',
                        text: 'An error occurred while approving the event.',
                        icon: 'error',
                        confirmButtonColor: '#EF4444'
                    });
                });
            }
        });
    }
    
    // Confirm reject event with SweetAlert
    function confirmReject(eventId, eventTitle) {
        Swal.fire({
            title: 'Reject Event?',
            text: `Are you sure you want to reject "${eventTitle}"?`,
            //input: 'textarea',
            //inputLabel: 'Reason for rejection',
            //inputPlaceholder: 'Please provide a reason for rejection...',
            //inputAttributes: {
            //    'aria-label': 'Reason for rejection',
            //    'data-testid': 'rejection-reason-input'
            //},
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#EF4444',
            cancelButtonColor: '#6B7280',
            confirmButtonText: 'Yes, reject it!',
            cancelButtonText: 'Cancel',
            customClass: {
                confirmButton: 'swal-confirm-button',
                cancelButton: 'swal-cancel-button'
            },
            showClass: {
                popup: 'animate__animated animate__fadeInDown'
            },
            hideClass: {
                popup: 'animate__animated animate__fadeOutUp'
            },
            preConfirm: (reason) => {
                //if (!reason.trim()) {
                //    Swal.showValidationMessage('Please provide a reason for rejection');
                //    return false;
                //}
                //return reason;
            }
        }).then((result) => {
            if (result.isConfirmed) {
                //const reason = result.value;
                
                // Show loading state
                const rejectBtn = document.querySelector(`button[onclick="event.stopPropagation(); confirmReject('${eventId}', '${eventTitle}')"]`);
                if (rejectBtn) {
                    rejectBtn.disabled = true;
                    rejectBtn.innerHTML = '<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Processing...';
                }
                const csrftoken = getCookie('csrftoken');
                
                console.log("data ",eventId, eventTitle);
                // Make API call to reject the event with reason
                const formData = new FormData();
                formData.append("uid", eventId);
                formData.append("action", "reject");
                fetch(`{% url "dashboard:approve_event" %}`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrftoken,
                        //'Content-Type': 'application/json',
                    },
                    body: formData
                })
                .then(response => {
                    console.log(response);
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status === 'success') {
                        Swal.fire({
                            title: 'Rejected!',
                            text: 'The event has been rejected successfully.',
                            icon: 'success',
                            confirmButtonColor: '#10B981',
                            timer: 2000,
                            timerProgressBar: true
                        }).then(() => {
                            location.reload();
                        });
                    } else {
                        // Reset button state
                        if (rejectBtn) {
                            rejectBtn.disabled = false;
                            rejectBtn.innerHTML = '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>Reject';
                        }
                        
                        Swal.fire({
                            title: 'Error!',
                            text: data.message || 'Something went wrong',
                            icon: 'error',
                            confirmButtonColor: '#EF4444'
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    
                    // Reset button state
                    if (rejectBtn) {
                        rejectBtn.disabled = false;
                        rejectBtn.innerHTML = '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>Reject';
                    }
                    
                    Swal.fire({
                        title: 'Error!',
                        text: 'An error occurred while rejecting the event.',
                        icon: 'error',
                        confirmButtonColor: '#EF4444'
                    });
                });
            }
        });
    }
    
    // Initialize all dropdowns as closed on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Hide all dropdown contents initially
        const dropdownContents = document.querySelectorAll('.dropdown-content');
        dropdownContents.forEach(content => {
            content.style.display = 'none';
        });
        
        // Add animate.css for SweetAlert animations
        const animateCss = document.createElement('link');
        animateCss.rel = 'stylesheet';
        animateCss.href = 'https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css';
        document.head.appendChild(animateCss);
    });

    function openModal(uid) {
      document.getElementById(`pending-${uid}`).classList.remove('hidden');
      document.getElementById(`pending-${uid}`).classList.add('flex');
    }
    function closeModal(uid) {
      document.getElementById(`pending-${uid}`).classList.add('hidden');
      document.getElementById(`pending-${uid}`).classList.remove('flex');
    }



</script>
{% endblock %}docuent.getElementByI(`pending-${uid}`)gEnById(`dng-$ui}`)x