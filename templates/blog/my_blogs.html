{% extends 'index.html' %}
{% load static %}

{% block title %}My Blogs - Event Niti{% endblock %}

{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-white border-b">
        <div class="container mx-auto px-4 py-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">My Blogs</h1>
                    <p class="text-gray-600 mt-2">Manage your blog posts and drafts</p>
                </div>
                <a href="{% url 'create_blog' %}" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                    <i class="fas fa-plus"></i>
                    New Blog Post
                </a>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- Filter Tabs -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <div class="flex flex-wrap gap-2">
                <a href="?status=all" class="px-4 py-2 rounded-full transition {% if status_filter == 'all' %}bg-blue-600 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                    All Posts
                </a>
                <a href="?status=published" class="px-4 py-2 rounded-full transition {% if status_filter == 'published' %}bg-blue-600 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                    Published
                </a>
                <a href="?status=draft" class="px-4 py-2 rounded-full transition {% if status_filter == 'draft' %}bg-blue-600 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                    Drafts
                </a>
                <a href="?status=deleted" class="px-4 py-2 rounded-full transition {% if status_filter == 'deleted' %}bg-blue-600 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                    Trash
                </a>
            </div>
        </div>

        <!-- Blog List -->
        <div class="space-y-6">
            {% for blog in blogs %}
            <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow">
                <div class="p-6">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <!-- Status and Meta -->
                            <div class="flex items-center gap-3 mb-3">
                                {% if blog.status == 'published' %}
                                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                                    <i class="fas fa-check-circle mr-1"></i>Published
                                </span>
                                {% elif blog.status == 'draft' %}
                                <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium">
                                    <i class="fas fa-edit mr-1"></i>Draft
                                </span>
                                {% elif blog.is_deleted %}
                                <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">
                                    <i class="fas fa-trash mr-1"></i>Deleted
                                </span>
                                {% endif %}
                                
                                {% if blog.is_featured %}
                                <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium">
                                    <i class="fas fa-star mr-1"></i>Featured
                                </span>
                                {% endif %}
                                
                                {% if blog.category %}
                                <span class="px-3 py-1 text-sm font-medium rounded-full" style="background-color: {{ blog.category.color }}20; color: {{ blog.category.color }}">
                                    {{ blog.category.name }}
                                </span>
                                {% endif %}
                            </div>

                            <!-- Title and Excerpt -->
                            <h3 class="text-xl font-bold text-gray-900 mb-2">
                                {% if blog.status == 'published' %}
                                <a href="{{ blog.get_absolute_url }}" class="hover:text-blue-600 transition">{{ blog.title }}</a>
                                {% else %}
                                {{ blog.title }}
                                {% endif %}
                            </h3>
                            
                            {% if blog.excerpt %}
                            <p class="text-gray-600 mb-4 line-clamp-2">{{ blog.excerpt }}</p>
                            {% endif %}

                            <!-- Stats -->
                            <div class="flex items-center gap-6 text-sm text-gray-500">
                                <span><i class="fas fa-eye mr-1"></i>{{ blog.view_count }} views</span>
                                <span><i class="fas fa-heart mr-1"></i>{{ blog.like_count }} likes</span>
                                <span><i class="fas fa-comment mr-1"></i>{{ blog.comment_count }} comments</span>
                                {% if blog.share_count %}
                                <span><i class="fas fa-share mr-1"></i>{{ blog.share_count }} shares</span>
                                {% endif %}
                            </div>

                            <!-- Dates -->
                            <div class="flex items-center gap-4 text-sm text-gray-500 mt-2">
                                <span>Created: {{ blog.created_at|date:"M d, Y H:i" }}</span>
                                {% if blog.updated_at != blog.created_at %}
                                <span>Updated: {{ blog.updated_at|date:"M d, Y H:i" }}</span>
                                {% endif %}
                                {% if blog.last_auto_save %}
                                <span class="text-blue-600">Auto-saved: {{ blog.last_auto_save|date:"H:i" }}</span>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Thumbnail -->
                        {% if blog.featured_image %}
                        <div class="ml-6">
                            <img src="{{ blog.featured_image.url }}" alt="{{ blog.title }}" class="w-24 h-24 object-cover rounded-lg">
                        </div>
                        {% endif %}
                    </div>

                    <!-- Actions -->
                    <div class="flex items-center justify-between mt-6 pt-6 border-t border-gray-200">
                        <div class="flex items-center gap-2">
                            {% if not blog.is_deleted %}
                            <a href="{% url 'edit_blog' blog.slug %}" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-sm font-medium">
                                <i class="fas fa-edit mr-1"></i>Edit
                            </a>
                            
                            {% if blog.status == 'published' %}
                            <a href="{{ blog.get_absolute_url }}" target="_blank" class="px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition text-sm font-medium">
                                <i class="fas fa-external-link-alt mr-1"></i>View
                            </a>
                            {% endif %}
                            
                            <button onclick="confirmDelete('{{ blog.slug }}', '{{ blog.title }}')" class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition text-sm font-medium">
                                <i class="fas fa-trash mr-1"></i>Delete
                            </button>
                            {% else %}
                            <a href="{% url 'restore_blog' blog.slug %}" class="px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition text-sm font-medium">
                                <i class="fas fa-undo mr-1"></i>Restore
                            </a>
                            
                            <button onclick="confirmPermanentDelete('{{ blog.slug }}', '{{ blog.title }}')" class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition text-sm font-medium">
                                <i class="fas fa-trash-alt mr-1"></i>Delete Permanently
                            </button>
                            {% endif %}
                        </div>

                        <!-- Quick Stats -->
                        <div class="text-sm text-gray-500">
                            {% if blog.read_time %}
                            <span>{{ blog.read_time }} min read</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="text-center py-12">
                <i class="fas fa-blog text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">
                    {% if status_filter == 'published' %}
                    No published posts yet
                    {% elif status_filter == 'draft' %}
                    No drafts found
                    {% elif status_filter == 'deleted' %}
                    Trash is empty
                    {% else %}
                    No blog posts yet
                    {% endif %}
                </h3>
                <p class="text-gray-500 mb-6">
                    {% if status_filter == 'published' %}
                    Publish your first blog post to see it here
                    {% elif status_filter == 'draft' %}
                    Start writing to create your first draft
                    {% elif status_filter == 'deleted' %}
                    Deleted posts will appear here
                    {% else %}
                    Start writing your first blog post
                    {% endif %}
                </p>
                {% if status_filter != 'deleted' %}
                <a href="{% url 'create_blog' %}" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-plus mr-2"></i>Create Your First Post
                </a>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if blogs.has_other_pages %}
        <div class="mt-12 flex justify-center">
            <nav class="flex items-center gap-2">
                {% if blogs.has_previous %}
                <a href="?page={{ blogs.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}" 
                   class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                    <i class="fas fa-chevron-left"></i>
                </a>
                {% endif %}
                
                {% for num in blogs.paginator.page_range %}
                {% if num == blogs.number %}
                <span class="px-4 py-2 bg-blue-600 text-white rounded-lg">{{ num }}</span>
                {% else %}
                <a href="?page={{ num }}{% if status_filter %}&status={{ status_filter }}{% endif %}" 
                   class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">{{ num }}</a>
                {% endif %}
                {% endfor %}
                
                {% if blogs.has_next %}
                <a href="?page={{ blogs.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}" 
                   class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                    <i class="fas fa-chevron-right"></i>
                </a>
                {% endif %}
            </nav>
        </div>
        {% endif %}
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-6 max-w-md mx-4">
        <div class="text-center">
            <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Delete Blog Post?</h3>
            <p class="text-gray-600 mb-6">Are you sure you want to delete "<span id="deleteTitle"></span>"? This action can be undone from the trash.</p>
            <div class="flex gap-3">
                <button onclick="closeDeleteModal()" class="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">
                    Cancel
                </button>
                <a id="deleteLink" href="#" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition text-center">
                    Delete
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function confirmDelete(slug, title) {
    document.getElementById('deleteTitle').textContent = title;
    document.getElementById('deleteLink').href = `/blog/delete/${slug}/`;
    document.getElementById('deleteModal').classList.remove('hidden');
    document.getElementById('deleteModal').classList.add('flex');
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.add('hidden');
    document.getElementById('deleteModal').classList.remove('flex');
}

function confirmPermanentDelete(slug, title) {
    if (confirm(`Are you sure you want to permanently delete "${title}"? This action cannot be undone.`)) {
        window.location.href = `/blog/delete-permanent/${slug}/`;
    }
}

// Close modal on outside click
document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeDeleteModal();
    }
});
</script>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>
{% endblock %}