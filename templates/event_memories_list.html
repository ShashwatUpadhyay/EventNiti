{% extends "index.html" %}

{% block title %}
{{ event.title }} Memories
{% endblock title %}

{% block content %}
{% load static %}
<div class="bg-gray-50 pt-20">

  <div class="flex flex-col md:flex-row justify-center items-center gap-4 md:gap-8  mb-4 md:mb-6 px-4">
      
          {% if user.is_authenticated %}
         {% if not user.is_student %}
         <a class="border-2 rounded-sm py-1 px-3 text-sm md:text-base hover:border-red-400" href="{% url "event_memory_upload" event.slug %}">Upload Here</a>
          {% endif %}
          {% endif %}
      <h1 class="text-4xl text-center font-bold text-purple-700 my-6">"Unforgettable Moments"ðŸ“¸ðŸŽ¥
      </h1>
  </div>

  <!-- Description -->
  <div class="flex justify-center items-center mt-20 p-4">
      <div class="max-w-5xl w-full bg-gray-100 p-6 md:p-8 border border-gray-700 rounded-lg shadow-lg">
          <h2 class="text-2xl md:text-3xl font-bold text-gray-800">{{event.title}}</h2>
          <p class="text-gray-600 text-sm md:text-base mt-1">{{event.start_date|date:'d F Y'}}</p>
          <p class="text-gray-700 mt-4 md:mt-8 text-sm md:text-base leading-relaxed">
              {{ memory.memory_description|default:'Description' }}
          </p>
      </div>
  </div>

  <!-- image albums -->
  <div class="grid grid-cols-2 md:grid-cols-3 gap-4 my-8 mx-8">
    {% for memory in memories %}
    {% for img in memory.memory_img.all %}
      <figure class="text-center border-2 bg-white p-4 rounded-lg hover:border-orange-500">
          <img class="h-auto max-w-full rounded-lg"
              src="{{ img.image.url }}" alt="">
          <figcaption class="mt-3 text-sm text-gray-600">{{ img.image_title|default:"No Title" }}</figcaption>
      </figure>
      {% endfor %}
            {% endfor %}
      
  </div>

  <script>
      document.addEventListener("DOMContentLoaded", () => {
          const images = document.querySelectorAll("figure img");
          const modal = document.createElement("div");
          modal.classList.add("fixed", "top-0", "left-0", "w-full", "h-full", "bg-black/80", "flex", "items-center", "justify-center", "hidden", "z-30");
          modal.innerHTML = `
  <div class="relative">
      <button id="closeModal" class="absolute top-2 right-2 bg-gray-200 px-3 py-1 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
</svg>
</button>
      <button id="prevImage" class="absolute left-2 top-1/2 -translate-y-1/2 bg-gray-200 px-3 py-1 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="m11.25 9-3 3m0 0 3 3m-3-3h7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
</svg>
</button>
      <img id="modalImage" class="max-w-full max-h-[90vh] rounded-lg" src="" alt="">
      <button id="nextImage" class="absolute right-2 top-1/2 -translate-y-1/2 bg-gray-200 px-3 py-1 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="m12.75 15 3-3m0 0-3-3m3 3h-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
</svg>
</button>
      <p id="modalCaption" class="text-center text-white mt-2"></p>
  </div>
`;
          document.body.appendChild(modal);

          let currentIndex = 0;

          images.forEach((img, index) => {
              img.addEventListener("click", () => {
                  currentIndex = index;
                  openModal();
              });
          });

          function openModal() {
              modal.classList.remove("hidden");
              updateModal();
          }

          function closeModal() {
              modal.classList.add("hidden");
          }

          function updateModal() {
              const img = images[currentIndex];
              document.getElementById("modalImage").src = img.src;
              document.getElementById("modalCaption").textContent = img.nextElementSibling.textContent;
          }

          document.getElementById("closeModal").addEventListener("click", closeModal);

          document.getElementById("nextImage").addEventListener("click", () => {
              if (currentIndex < images.length - 1) {
                  currentIndex++;
                  updateModal();
              }
          });

          document.getElementById("prevImage").addEventListener("click", () => {
              if (currentIndex > 0) {
                  currentIndex--;
                  updateModal();
              }
          });

          modal.addEventListener("click", (event) => {
              if (event.target === modal) closeModal();
          });
      });

  </script>

</div>


{% endblock content %}