{% extends "index.html" %}

{% block title %}
{{ event.title }} Memories
{% endblock title %}

{% block content %}
{% load static %}
<div class="bg-gray-100 font-sans pt-12">
    <header class="text-white py-6 pt-12 bg-gradient-to-r from-blue-600 to-purple-500">
      <div class="container mx-auto px-6 text-center">
        <h1 class="text-4xl font-bold">{{ event.title }}</h1>
        <p class="mt-2 text-lg text-center">A gallery of moments worth remembering</p>
      </div>
    </header>

    <section id="memories" class="py-16 bg-blue-50">
      
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl font-bold text-blue-600">Memories from {{ event.title }} event on {{ event.start_date|date:'M d, Y' }}.</h2>
        {% comment %} <p class="mt-4 text-gray-600"><h1>Memories for </h1></p> {% endcomment %}
         {% if user.is_authenticated %}
         {% if not user.is_student %}
         <a href='{% url "event_memory_upload" event.slug %}'>
           <button  class="bg-blue-600 text-white font-semibold py-2 my-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-300">
             Upload Photo
            </button>
          </a>
          {% endif %}
          {% endif %}
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-6 bg-gray-100"> 
              {% for memory in memories %}
                    {% for img in memory.memory_img.all %}
                          <div class="text-center">
                            <img src="{{ img.image.url }}" alt="Memory" class="w-full h-56 object-cover rounded-lg shadow-md hover:opacity-80 transition duration-300" onclick="openModal('{{ img.image.url }}', '{{ img.image_title }}', '{{ img.image_date }}')">
                            <p class="mt-2 text-gray-700 font-semibold">{{ img.image_title|default:"--No context--" }}</p>
                        </div>
                      <div id="imageModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex justify-center items-center hidden" onclick="closeModal()">
                        <div class="relative bg-white p-4 rounded-lg">
                            <img id="modalImage" class="w-full max-w-4xl max-h-screen object-contain" />
                            <p id="modalImageTitle" class="mt-4 text-center text-xl font-semibold text-blue-600"><p class="text-center mt-2">{{ img.image_title|default:"--No context--" }}</p></p>
                            <span id="modalImageDate" class="block text-center text-sm text-gray-500"></span>
                            <button onclick="closeModal()" class="absolute top-4 right-4 text-white text-xl font-bold"><svg fill="#00FF00" height="20px" width="20px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 490 490" xml:space="preserve" stroke="#fafafa"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <polygon points="456.851,0 245,212.564 33.149,0 0.708,32.337 212.669,245.004 0.708,457.678 33.149,490 245,277.443 456.851,490 489.292,457.678 277.331,245.004 489.292,32.337 "></polygon> </g></svg></button>
                        </div>
                      </div>
                     {% endfor %}

                     {% if vdo %}
                        <h1 class='text-center'>Videos</h1>
                        {% for vdo in memory.memory_vdo.all %}
                        <div class="bg-white rounded-lg shadow-md overflow-hidden">
                            <video controls class="w-full">
                                <source src="{{ vdo.video.url }}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <p>{{ vdo.video_title }}</p>

                        </div>
                        {% endfor %}
                 {% endif %}
                {% endfor %}
            </div>
        </div>
    </section>
  </div>
  <script>
    // Function to open the modal
    function openModal(imageUrl, imageTitle, imageDate) {
        const modal = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');
        const modalImageTitle = document.getElementById('modalImageTitle');
        const modalImageDate = document.getElementById('modalImageDate');
        
        // Set the image source and title
        modalImage.src = imageUrl;
        //modalImageTitle.textContent = imageTitle;
        modalImageDate.textContent = imageDate;
        
        // Display the modal
        modal.classList.remove('hidden');
    }

    // Function to close the modal
    function closeModal() {
        const modal = document.getElementById('imageModal');
        modal.classList.add('hidden');
    }
</script>
{% endblock content %}